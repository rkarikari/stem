<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ultimate Ghana Black Stars tactical lineup builder for 2026 World Cup with AI-powered recommendations and advanced analytics">
    <title>Ghana Black Stars Ultimate Lineup Builder 2026</title>
    <style>
        :root {
            --primary-gold: #d4af37;
            --primary-red: #ce1126;
            --primary-green: #006b3f;
            --accent-yellow: #fcd116;
            --bg-dark: #0d2818;
            --bg-card: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.8);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.3);
            --shadow-md: 0 5px 15px rgba(0,0,0,0.4);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.5);
            --transition-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-smooth: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a472a 0%, var(--bg-dark) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container { 
            max-width: 1600px; 
            margin: 0 auto;
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: var(--bg-card);
            border-radius: 20px;
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.1) 0%, transparent 70%);
            animation: pulse 8s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }
        
        h1 {
            font-size: clamp(1.8em, 5vw, 3em);
            margin-bottom: 10px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
            background: linear-gradient(135deg, var(--primary-gold), var(--accent-yellow));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }
        
        .flag-colors {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
            position: relative;
            z-index: 1;
        }
        
        .flag-colors div {
            width: 80px;
            height: 10px;
            border-radius: 5px;
            box-shadow: var(--shadow-sm);
            transition: transform var(--transition-fast);
        }
        
        .flag-colors div:hover {
            transform: scaleY(1.5);
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-card {
            background: var(--bg-card);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-md);
            transition: all var(--transition-smooth);
        }
        
        .control-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-gold);
        }
        
        .control-label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            font-weight: 600;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            color: var(--primary-gold);
        }
        
        .control-label::before {
            content: '‚ñ∏';
            color: var(--accent-yellow);
        }
        
        select, button {
            width: 100%;
            padding: 14px 18px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            transition: all var(--transition-smooth);
            font-family: inherit;
        }
        
        select {
            background: rgba(255, 255, 255, 0.95);
            color: #1a472a;
            font-weight: 500;
            border: 2px solid transparent;
        }
        
        select:hover {
            background: white;
            border-color: var(--primary-gold);
        }
        
        select:focus {
            outline: none;
            border-color: var(--primary-gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
        }
        
        button {
            background: linear-gradient(135deg, var(--primary-gold) 0%, var(--accent-yellow) 100%);
            color: #1a472a;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 12px;
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.5);
        }
        
        button:active {
            transform: translateY(-1px);
        }
        
        button > span {
            position: relative;
            z-index: 1;
        }
        
        .pitch-container {
            background: linear-gradient(to bottom, #2d5a3d 0%, #1a3d2a 100%);
            border-radius: 20px;
            padding: 40px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            margin-bottom: 30px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .pitch-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center, rgba(212, 175, 55, 0.05) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .pitch {
            position: relative;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            aspect-ratio: 0.7;
            background: 
                repeating-linear-gradient(90deg, transparent, transparent 49.5%, rgba(255,255,255,0.12) 49.5%, rgba(255,255,255,0.12) 50.5%, transparent 50.5%),
                repeating-linear-gradient(0deg, transparent, transparent 19.5%, rgba(255,255,255,0.12) 19.5%, rgba(255,255,255,0.12) 20.5%, transparent 20.5%);
            border: 4px solid rgba(255,255,255,0.4);
            border-radius: 15px;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.3);
        }
        
        .pitch::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(255,255,255,0.4);
            box-shadow: 0 0 10px rgba(255,255,255,0.3);
        }
        
        .pitch::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 140px;
            height: 140px;
            border: 3px solid rgba(255,255,255,0.4);
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(255,255,255,0.2);
        }
        
        .formation-line {
            position: absolute;
            width: 100%;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 15px;
        }
        
        .player-slot {
            background: linear-gradient(135deg, var(--primary-gold) 0%, var(--accent-yellow) 100%);
            border: 5px solid #1a472a;
            border-radius: 50%;
            width: 100px;
            height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-smooth);
            position: relative;
            box-shadow: var(--shadow-md), 0 0 0 0 rgba(212, 175, 55, 0.4);
            animation: playerPulse 2s ease-in-out infinite;
        }
        
        @keyframes playerPulse {
            0%, 100% { box-shadow: var(--shadow-md), 0 0 0 0 rgba(212, 175, 55, 0.4); }
            50% { box-shadow: var(--shadow-md), 0 0 0 10px rgba(212, 175, 55, 0); }
        }
        
        .player-slot:hover {
            transform: scale(1.2) rotate(5deg);
            box-shadow: 0 12px 30px rgba(212, 175, 55, 0.7);
            z-index: 100;
            animation: none;
        }
        
        .player-slot.selected {
            background: linear-gradient(135deg, var(--primary-red) 0%, #ff4444 100%);
            border-color: #fff;
            animation: selectedGlow 1.5s ease-in-out infinite;
        }
        
        @keyframes selectedGlow {
            0%, 100% { box-shadow: 0 5px 15px rgba(206, 17, 38, 0.5), 0 0 20px rgba(206, 17, 38, 0.3); }
            50% { box-shadow: 0 8px 25px rgba(206, 17, 38, 0.8), 0 0 30px rgba(206, 17, 38, 0.5); }
        }
        
        .player-name {
            font-size: 0.8em;
            font-weight: 900;
            text-align: center;
            color: #000;
            margin-top: 4px;
            text-shadow: 0 0 5px rgba(255,255,255,0.9);
            line-height: 1.1;
            padding: 0 6px;
            max-width: 90%;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .player-slot.selected .player-name {
            color: #fff;
            text-shadow: 0 0 8px rgba(0,0,0,0.9), 0 2px 6px rgba(0,0,0,0.8);
        }
        
        .player-rating {
            position: absolute;
            top: -12px;
            right: -12px;
            background: #000;
            color: var(--accent-yellow);
            width: 38px;
            height: 38px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.95em;
            font-weight: 900;
            border: 4px solid var(--accent-yellow);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-fast);
        }
        
        .player-slot:hover .player-rating {
            transform: scale(1.15) rotate(10deg);
        }
        
        .player-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(10px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a472a 0%, var(--bg-dark) 100%);
            padding: 35px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            border: 2px solid var(--primary-gold);
            animation: modalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        @keyframes modalSlideIn {
            from { transform: scale(0.8) translateY(-50px); }
            to { transform: scale(1) translateY(0); }
        }
        
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .modal-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .modal-content::-webkit-scrollbar-thumb {
            background: var(--primary-gold);
            border-radius: 10px;
        }
        
        .modal-content h2 {
            color: var(--primary-gold);
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .player-list {
            display: grid;
            gap: 12px;
        }
        
        .player-item {
            background: var(--bg-card);
            padding: 18px;
            border-radius: 12px;
            cursor: pointer;
            transition: all var(--transition-smooth);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid transparent;
        }
        
        .player-item:hover {
            background: rgba(212, 175, 55, 0.25);
            transform: translateX(8px) scale(1.02);
            border-color: var(--primary-gold);
            box-shadow: var(--shadow-md);
        }
        
        .player-info {
            flex: 1;
        }
        
        .player-info strong {
            color: var(--primary-gold);
            display: block;
            margin-bottom: 6px;
            font-size: 1.1em;
        }
        
        .player-info small {
            color: var(--text-secondary);
            font-size: 0.9em;
        }
        
        .stats-panel {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 20px;
            margin-top: 30px;
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-md);
            transition: all var(--transition-smooth);
        }
        
        .stats-panel:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .stats-panel h2 {
            color: var(--primary-gold);
            margin-bottom: 20px;
            font-size: 1.6em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-item {
            text-align: center;
            padding: 20px;
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            transition: all var(--transition-smooth);
            border: 2px solid transparent;
        }
        
        .stat-item:hover {
            background: rgba(212, 175, 55, 0.15);
            transform: translateY(-5px);
            border-color: var(--primary-gold);
        }
        
        .stat-value {
            font-size: 2.5em;
            color: var(--primary-gold);
            font-weight: 900;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .stat-label {
            font-size: 0.9em;
            margin-top: 8px;
            opacity: 0.85;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .close-modal {
            background: linear-gradient(135deg, var(--primary-red) 0%, #8b0000 100%);
            color: white;
            margin-top: 25px;
        }
        
        .ai-recommendation {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(75, 0, 130, 0.2));
            border: 2px solid rgba(138, 43, 226, 0.5);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .ai-badge {
            display: inline-block;
            background: linear-gradient(135deg, #8a2be2, #4b0082);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: bold;
            margin-left: 8px;
        }
        
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid var(--primary-gold);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 1.8em; }
            .player-slot { width: 75px; height: 75px; }
            .player-name { font-size: 0.7em; }
            .player-rating { width: 32px; height: 32px; font-size: 0.8em; }
            .controls-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
        
        .accessibility-label {
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, var(--primary-gold), var(--accent-yellow));
            color: #1a472a;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: var(--shadow-lg);
            font-weight: 600;
            z-index: 2000;
            animation: slideInRight 0.4s ease-out;
        }

        @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üá¨üá≠ GHANA BLACK STARS 2026</h1>
            <p class="subtitle">Ultimate Tactical Lineup Builder - World Cup Ready</p>
            <div class="flag-colors">
                <div style="background: #ce1126;"></div>
                <div style="background: #fcd116;"></div>
                <div style="background: #006b3f;"></div>
            </div>
        </header>

        <div class="controls-grid">
            <div class="control-card">
                <label class="control-label">Formation Strategy</label>
                <select id="formationSelect" aria-label="Select formation">
                    <option value="4-3-3">4-3-3 (Attacking)</option>
                    <option value="4-2-3-1">4-2-3-1 (Balanced)</option>
                    <option value="4-4-2">4-4-2 (Classic)</option>
                    <option value="3-5-2">3-5-2 (Defensive)</option>
                    <option value="4-1-4-1">4-1-4-1 (Possession)</option>
                    <option value="3-4-3">3-4-3 (Ultra Attack)</option>
                    <option value="5-3-2">5-3-2 (Counter)</option>
                    <option value="4-4-2-diamond">4-4-2 Diamond</option>
                </select>
            </div>

            <div class="control-card">
                <label class="control-label">Squad Selection</label>
                <select id="squadMode" aria-label="Select squad mode">
                    <option value="full">Full Player Pool (64 players)</option>
                    <option value="worldcup">World Cup Squad (0/26 selected)</option>
                </select>
                <button onclick="openWorldCupBuilder()"><span>‚öΩ Build WC Squad</span></button>
            </div>

            <div class="control-card">
                <label class="control-label">AI Auto-Select</label>
                <select id="autoSelectCriteria" aria-label="Select criteria">
                    <option value="rating">Overall Rating</option>
                    <option value="form">Current Form</option>
                    <option value="experience">Experience</option>
                    <option value="versatility">Versatility</option>
                </select>
                <button onclick="autoSelectPlayers()"><span>ü§ñ AI Fill Lineup</span></button>
            </div>

            <div class="control-card">
                <label class="control-label">Visual Theme</label>
                <select id="colorTheme" aria-label="Select color theme">
                    <option value="classic">Classic Gold</option>
                    <option value="red">Red & White</option>
                    <option value="green">Green & Gold</option>
                    <option value="black">Black & Gold</option>
                    <option value="blue">Blue & White</option>
                </select>
            </div>

            <div class="control-card">
                <label class="control-label">Export Options</label>
                <button onclick="exportAsImage()"><span>üì∏ Export JPG</span></button>
                <button onclick="exportAsPDF()"><span>üìÑ Export PDF</span></button>
            </div>

            <div class="control-card">
                <label class="control-label">Quick Actions</label>
                <button onclick="clearLineup()"><span>üîÑ Clear Lineup</span></button>
                <button onclick="randomizeLineup()"><span>üé≤ Randomize</span></button>
            </div>
        </div>

        <div class="pitch-container">
            <div class="pitch" id="pitch" role="region" aria-label="Football pitch with player positions"></div>
        </div>

        <div class="stats-panel">
            <h2>üìä Team Analytics</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="avgRating">0</div>
                    <div class="stat-label">Avg Rating</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="avgAge">0</div>
                    <div class="stat-label">Avg Age</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalCaps">0</div>
                    <div class="stat-label">Total Caps</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="attackScore">0</div>
                    <div class="stat-label">Attack Power</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="defenseScore">0</div>
                    <div class="stat-label">Defense Power</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="chemistryScore">0</div>
                    <div class="stat-label">Chemistry</div>
                </div>
            </div>
        </div>

        <div class="stats-panel">
            <h2>üèÜ World Cup Squad</h2>
            <p style="opacity: 0.9; margin-bottom: 15px; font-size: 0.95em;">Your 26-man roster for FIFA World Cup 2026</p>
            <div id="worldCupSquad" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;"></div>
        </div>

        <div class="stats-panel">
            <h2>‚ö° Formation Rankings</h2>
            <p style="opacity: 0.9; margin-bottom: 15px; font-size: 0.95em;">AI-powered analysis based on player strengths</p>
            <div id="formationRankings" style="display: grid; gap: 12px;"></div>
        </div>
    </div>

    <div class="player-modal" id="playerModal" role="dialog" aria-modal="true">
        <div class="modal-content">
            <h2>Select Player</h2>
            <div class="player-list" id="playerList"></div>
            <button class="close-modal" onclick="closeModal()"><span>Close</span></button>
        </div>
    </div>

    <div class="player-modal" id="worldCupModal" role="dialog" aria-modal="true">
        <div class="modal-content" style="max-width: 900px;">
            <h2>üèÜ Build Your 2026 World Cup Squad</h2>
            <p style="text-align: center; margin-bottom: 20px; opacity: 0.9;">Select exactly 26 players. Recommended: 3 GK, 8-9 DEF, 7-8 MID, 7-8 ATT</p>
            <div style="background: var(--bg-card); padding: 20px; border-radius: 15px; margin-bottom: 25px; text-align: center; border: 2px solid var(--primary-gold);">
                <div style="font-size: 1.8em; color: var(--accent-yellow); font-weight: bold;" id="wcSquadCount">0 / 26 Selected</div>
            </div>
            <div id="wcPlayerList" style="max-height: 50vh; overflow-y: auto;"></div>
            <div style="display: flex; gap: 15px; margin-top: 25px; flex-wrap: wrap;">
                <button onclick="saveWorldCupSquad()" style="flex: 1; min-width: 200px; background: linear-gradient(135deg, var(--primary-green) 0%, #004d2d 100%);"><span>‚úì Save & Use Squad</span></button>
                <button onclick="autoSelectWorldCup()" style="flex: 1; min-width: 200px;"><span>‚ö° Auto-Select Best 26</span></button>
                <button class="close-modal" onclick="closeWorldCupModal()" style="flex: 1; min-width: 200px;"><span>Cancel</span></button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
const players = {
    GK: [
        {name: 'Ati-Zigi', fullName: 'Lawrence Ati-Zigi', club: 'St. Gallen', rating: 78, age: 28, caps: 18, form: 8, versatility: 1},
        {name: 'Asare', fullName: 'Benjamin Asare', club: 'Hearts of Oak', rating: 76, age: 25, caps: 8, form: 9, versatility: 1},
        {name: 'Nurudeen', fullName: 'Abdul Manaf Nurudeen', club: 'KAS Eupen', rating: 74, age: 26, caps: 6, form: 7, versatility: 1},
        {name: 'Anang', fullName: 'Joseph Anang', club: "St Patrick's", rating: 74, age: 24, caps: 3, form: 7, versatility: 1},
        {name: 'Wollacott', fullName: 'Joseph Wollacott', club: 'Hibernian', rating: 73, age: 29, caps: 9, form: 7, versatility: 1}
    ],
    DEF: [
        {name: 'Salisu', fullName: 'Mohammed Salisu', club: 'Monaco', rating: 82, age: 26, caps: 22, form: 8, versatility: 7, positions: ['CB', 'LB']},
        {name: 'Djiku', fullName: 'Alexander Djiku', club: 'Spartak Moscow', rating: 81, age: 31, caps: 37, form: 8, versatility: 7, positions: ['CB', 'RB']},
        {name: 'Lamptey', fullName: 'Tariq Lamptey', club: 'Brighton', rating: 80, age: 24, caps: 15, form: 8, versatility: 6, positions: ['RB', 'RW']},
        {name: 'Seidu', fullName: 'Alidu Seidu', club: 'Stade Rennes', rating: 78, age: 25, caps: 22, form: 8, versatility: 7, positions: ['RB', 'CB']},
        {name: 'Kohn', fullName: 'Derrick Kohn', club: 'Union Berlin', rating: 77, age: 26, caps: 10, form: 8, versatility: 6, positions: ['LB', 'LWB']},
        {name: 'Mensah', fullName: 'Gideon Mensah', club: 'AJ Auxerre', rating: 76, age: 27, caps: 18, form: 7, versatility: 5, positions: ['LB']},
        {name: 'Ambrosius', fullName: 'Stephan Ambrosius', club: 'St. Gallen', rating: 77, age: 26, caps: 10, form: 7, versatility: 6, positions: ['CB']},
        {name: 'Mumin', fullName: 'Abdul Mumin', club: 'Rayo Vallecano', rating: 76, age: 27, caps: 15, form: 7, versatility: 6, positions: ['CB']},
        {name: 'Adjei', fullName: 'Nathaniel Adjei', club: 'FC Lorient', rating: 75, age: 25, caps: 5, form: 7, versatility: 5, positions: ['CB']},
        {name: 'Opoku J.', fullName: 'Jerome Opoku', club: 'Istanbul Basaksehir', rating: 75, age: 26, caps: 11, form: 7, versatility: 6, positions: ['CB']},
        {name: 'Annan', fullName: 'Ebenezer Annan', club: 'AS Saint-Etienne', rating: 74, age: 24, caps: 7, form: 7, versatility: 5, positions: ['CB']},
        {name: 'Simpson', fullName: 'Razak Simpson', club: 'Nations FC', rating: 73, age: 24, caps: 6, form: 8, versatility: 6, positions: ['RB', 'CB']},
        {name: 'Adjetey', fullName: 'Jonas Adjetey', club: 'FC Basel', rating: 74, age: 25, caps: 7, form: 7, versatility: 6, positions: ['CB']},
        {name: 'Afful', fullName: 'Isaac Afful', club: 'Samartex', rating: 71, age: 23, caps: 3, form: 7, versatility: 5, positions: ['RB']},
        {name: 'Schindler', fullName: 'Kingsley Schindler', club: 'Hannover 96', rating: 73, age: 32, caps: 9, form: 6, versatility: 6, positions: ['RB', 'RW']}
    ],
    MID: [
        {name: 'Partey', fullName: 'Thomas Partey', club: 'Arsenal', rating: 84, age: 32, caps: 58, form: 8, versatility: 7, positions: ['DM', 'CM']},
        {name: 'Kudus', fullName: 'Mohammed Kudus', club: 'West Ham', rating: 84, age: 25, caps: 32, form: 9, versatility: 9, positions: ['AM', 'RW', 'ST', 'CM']},
        {name: 'Ashimeru', fullName: 'Majeed Ashimeru', club: 'Anderlecht', rating: 77, age: 28, caps: 24, form: 7, versatility: 6, positions: ['CM', 'DM']},
        {name: 'Samed', fullName: 'Salis Abdul Samed', club: 'RC Lens', rating: 78, age: 25, caps: 17, form: 8, versatility: 6, positions: ['DM', 'CM']},
        {name: 'E. Owusu', fullName: 'Elisha Owusu', club: 'AJ Auxerre', rating: 76, age: 28, caps: 20, form: 7, versatility: 6, positions: ['DM', 'CM']},
        {name: 'Sulemana I.', fullName: 'Ibrahim Sulemana', club: 'Atalanta', rating: 76, age: 22, caps: 8, form: 7, versatility: 6, positions: ['CM']},
        {name: 'Diomande', fullName: 'Mohamed Diomande', club: 'Rangers', rating: 74, age: 23, caps: 5, form: 8, versatility: 7, positions: ['CM', 'DM']},
        {name: 'Sibo', fullName: 'Kwasi Sibo', club: 'Hearts of Oak', rating: 73, age: 23, caps: 6, form: 8, versatility: 6, positions: ['CM', 'DM']},
        {name: 'Francis', fullName: 'Abu Francis', club: 'Cercle Brugge', rating: 75, age: 23, caps: 10, form: 7, versatility: 6, positions: ['CM', 'AM']},
        {name: 'Addo E.', fullName: 'Edmund Addo', club: 'Sheriff Tiraspol', rating: 73, age: 25, caps: 12, form: 7, versatility: 5, positions: ['DM']},
        {name: 'Mamudu', fullName: 'Kamaradini Mamudu', club: 'Medeama SC', rating: 72, age: 23, caps: 5, form: 7, versatility: 6, positions: ['CM']},
        {name: 'Baidoo', fullName: 'Michael Baidoo', club: 'Elfsborg', rating: 73, age: 26, caps: 5, form: 7, versatility: 6, positions: ['CM', 'AM']},
        {name: 'Antwi', fullName: 'Emmanuel Antwi', club: 'FK Pribram', rating: 71, age: 24, caps: 4, form: 7, versatility: 6, positions: ['CM']},
        {name: 'P. Owusu', fullName: 'Prince Owusu', club: 'Medeama SC', rating: 70, age: 21, caps: 3, form: 8, versatility: 6, positions: ['CM']}
    ],
    VERSATILE: [
        {name: 'Yirenkyi', fullName: 'Caleb Yirenkyi', club: 'Nordsjaelland', rating: 73, age: 20, caps: 4, form: 8, versatility: 8, positions: ['CM', 'AM', 'RB', 'RW']}
    ],
    ATT: [
        {name: 'I. Williams', fullName: 'Inaki Williams', club: 'Athletic Bilbao', rating: 82, age: 31, caps: 24, form: 9, versatility: 7, positions: ['ST', 'RW']},
        {name: 'Semenyo', fullName: 'Antoine Semenyo', club: 'Bournemouth', rating: 81, age: 26, caps: 18, form: 9, versatility: 7, positions: ['ST', 'RW']},
        {name: 'J. Ayew', fullName: 'Jordan Ayew', club: 'Leicester', rating: 79, age: 34, caps: 118, form: 8, versatility: 8, positions: ['ST', 'RW', 'LW']},
        {name: 'Fatawu', fullName: 'Abdul Fatawu Issahaku', club: 'Leicester', rating: 79, age: 21, caps: 23, form: 8, versatility: 7, positions: ['RW', 'LW']},
        {name: 'Thomas-Asante', fullName: 'Brandon Thomas-Asante', club: 'Coventry City', rating: 78, age: 27, caps: 9, form: 9, versatility: 6, positions: ['ST', 'RW']},
        {name: 'Sulemana K.', fullName: 'Kamaldeen Sulemana', club: 'Southampton', rating: 78, age: 23, caps: 18, form: 7, versatility: 8, positions: ['LW', 'RW', 'ST']},
        {name: 'Nuamah', fullName: 'Ernest Nuamah', club: 'Lyon', rating: 77, age: 22, caps: 12, form: 8, versatility: 7, positions: ['RW', 'LW']},
        {name: 'Paintsil', fullName: 'Joseph Paintsil', club: 'LA Galaxy', rating: 77, age: 28, caps: 12, form: 8, versatility: 7, positions: ['RW', 'LW']},
        {name: 'Bonsu Baah', fullName: 'Christopher Bonsu Baah', club: 'KRC Genk', rating: 75, age: 23, caps: 8, form: 8, versatility: 7, positions: ['RW', 'LW']},
        {name: 'Ibrahim Osman', fullName: 'Ibrahim Osman', club: 'Feyenoord', rating: 75, age: 20, caps: 7, form: 8, versatility: 7, positions: ['RW', 'LW', 'AM']},
        {name: 'Adu Kwabena', fullName: 'Prince Kwabena Adu', club: 'Viktoria Plzen', rating: 75, age: 22, caps: 2, form: 8, versatility: 7, positions: ['ST', 'RW', 'LW']},
        {name: 'Afriyie', fullName: 'Jerry Afriyie', club: 'RAAL La Louviere', rating: 73, age: 20, caps: 3, form: 8, versatility: 6, positions: ['ST']},
        {name: 'Afena-Gyan', fullName: 'Felix Afena-Gyan', club: 'Cremonese', rating: 73, age: 21, caps: 5, form: 7, versatility: 6, positions: ['ST']},
        {name: 'Opoku', fullName: 'Kwame Opoku', club: 'Asante Kotoko', rating: 72, age: 23, caps: 2, form: 7, versatility: 5, positions: ['ST']},
        {name: 'Fuseini', fullName: 'Mohammed Fuseini', club: 'Union SG', rating: 71, age: 22, caps: 1, form: 7, versatility: 6, positions: ['LW', 'ST']},
        {name: 'Nkrumah', fullName: 'Kelvin Nkrumah', club: 'Medeama SC', rating: 70, age: 21, caps: 1, form: 8, versatility: 6, positions: ['LW', 'RW']},
        {name: 'Owusu P.O.', fullName: 'Prince Osei Owusu', club: 'CF Montreal', rating: 75, age: 28, caps: 1, form: 8, versatility: 6, positions: ['ST']}
    ]
};

let currentSquadMode = 'full';
let worldCupSquad = [];
const formations = {
    '4-3-3': {
        lines: [
            {positions: ['GK'], y: 95},
            {positions: ['LB', 'CB', 'CB', 'RB'], y: 75},
            {positions: ['CM', 'CM', 'CM'], y: 50},
            {positions: ['LW', 'ST', 'RW'], y: 20}
        ]
    },
    '4-2-3-1': {
        lines: [
            {positions: ['GK'], y: 95},
            {positions: ['LB', 'CB', 'CB', 'RB'], y: 75},
            {positions: ['DM', 'DM'], y: 60},
            {positions: ['LW', 'AM', 'RW'], y: 38},
            {positions: ['ST'], y: 15}
        ]
    },
    '4-4-2': {
        lines: [
            {positions: ['GK'], y: 95},
            {positions: ['LB', 'CB', 'CB', 'RB'], y: 75},
            {positions: ['LM', 'CM', 'CM', 'RM'], y: 50},
            {positions: ['ST', 'ST'], y: 20}
        ]
    },
    '3-5-2': {
        lines: [
            {positions: ['GK'], y: 95},
            {positions: ['CB', 'CB', 'CB'], y: 75},
            {positions: ['LWB', 'CM', 'DM', 'CM', 'RWB'], y: 50},
            {positions: ['ST', 'ST'], y: 20}
        ]
    },
    '4-1-4-1': {
        lines: [
            {positions: ['GK'], y: 95},
            {positions: ['LB', 'CB', 'CB', 'RB'], y: 75},
            {positions: ['DM'], y: 62},
            {positions: ['LM', 'CM', 'CM', 'RM'], y: 42},
            {positions: ['ST'], y: 15}
        ]
    },
    '3-4-3': {
        lines: [
            {positions: ['GK'], y: 95},
            {positions: ['CB', 'CB', 'CB'], y: 75},
            {positions: ['LM', 'CM', 'CM', 'RM'], y: 50},
            {positions: ['LW', 'ST', 'RW'], y: 20}
        ]
    },
    '5-3-2': {
        lines: [
            {positions: ['GK'], y: 95},
            {positions: ['LWB', 'CB', 'CB', 'CB', 'RWB'], y: 75},
            {positions: ['CM', 'DM', 'CM'], y: 50},
            {positions: ['ST', 'ST'], y: 20}
        ]
    },
    '4-4-2-diamond': {
        lines: [
            {positions: ['GK'], y: 95},
            {positions: ['LB', 'CB', 'CB', 'RB'], y: 75},
            {positions: ['DM'], y: 62},
            {positions: ['CM', 'CM'], y: 50},
            {positions: ['AM'], y: 32},
            {positions: ['ST', 'ST'], y: 15}
        ]
    }
};

let selectedLineup = {};
let currentSlot = null;

function renderFormation(formation) {
    const pitch = document.getElementById('pitch');
    pitch.innerHTML = '';
    selectedLineup = {};
    const fm = formations[formation];
    fm.lines.forEach((line, lineIdx) => {
        const lineDiv = document.createElement('div');
        lineDiv.className = 'formation-line';
        lineDiv.style.top = line.y + '%';
        line.positions.forEach((pos, posIdx) => {
            const slot = document.createElement('div');
            slot.className = 'player-slot';
            const slotId = `${pos}-${lineIdx}-${posIdx}`;
            slot.id = slotId;
            slot.onclick = () => openPlayerSelection(slotId, pos);
            const nameDiv = document.createElement('div');
            nameDiv.className = 'player-name';
            nameDiv.textContent = pos;
            slot.appendChild(nameDiv);
            lineDiv.appendChild(slot);
        });
        pitch.appendChild(lineDiv);
    });
    updateStats();
}

function openPlayerSelection(slotId, position) {
    currentSlot = {id: slotId, position: position};
    const modal = document.getElementById('playerModal');
    const playerList = document.getElementById('playerList');
    playerList.innerHTML = '';
    const availablePlayers = getPlayersForPosition(position);
    availablePlayers.forEach(player => {
        const item = document.createElement('div');
        item.className = 'player-item';
        item.onclick = () => selectPlayer(player);
        item.innerHTML = `
            <div class="player-info">
                <strong>${player.fullName}</strong>
                <small>${player.club} | ${player.age}y | ${player.caps} caps | Form: ${player.form}/10</small>
            </div>
            <div class="player-rating" style="position:static;width:45px;height:45px;font-size:1.15em;">${player.rating}</div>
        `;
        playerList.appendChild(item);
    });
    modal.style.display = 'flex';
}

function getPlayersForPosition(pos) {
    const positionMap = {
        'GK': ['GK'],
        'CB': ['DEF'],
        'LB': ['DEF'],
        'RB': ['DEF', 'VERSATILE'],
        'LWB': ['DEF'],
        'RWB': ['DEF'],
        'DM': ['MID'],
        'CM': ['MID', 'VERSATILE'],
        'AM': ['MID', 'VERSATILE'],
        'LM': ['MID'],
        'RM': ['MID', 'VERSATILE'],
        'LW': ['ATT'],
        'RW': ['ATT', 'VERSATILE'],
        'ST': ['ATT']
    };
    let categories = positionMap[pos];
    let allPlayers = [];
    categories.forEach(cat => {
        if (players[cat]) allPlayers = allPlayers.concat(players[cat]);
    });
    if (currentSquadMode === 'worldcup') {
        allPlayers = allPlayers.filter(p => worldCupSquad.includes(p.fullName));
    }
    return allPlayers.filter(p => {
        if (pos === 'GK') return true;
        if (!p.positions) return true;
        const compatiblePositions = {
            'CB': ['CB'],
            'LB': ['LB'],
            'RB': ['RB'],
            'LWB': ['LB', 'LWB'],
            'RWB': ['RB', 'RWB'],
            'DM': ['DM'],
            'CM': ['CM', 'DM'],
            'AM': ['AM', 'CM'],
            'LM': ['LW', 'LM', 'CM'],
            'RM': ['RW', 'RM', 'CM'],
            'LW': ['LW', 'RW'],
            'RW': ['RW', 'LW'],
            'ST': ['ST']
        };
        return compatiblePositions[pos]?.some(cp => p.positions.includes(cp)) || p.versatility >= 7;
    }).sort((a, b) => b.rating - a.rating);
}

function selectPlayer(player) {
    if (!currentSlot) return;
    selectedLineup[currentSlot.id] = player;
    const slot = document.getElementById(currentSlot.id);
    slot.classList.add('selected');
    const nameDiv = slot.querySelector('.player-name');
    nameDiv.textContent = player.name;
    let ratingDiv = slot.querySelector('.player-rating');
    if (!ratingDiv) {
        ratingDiv = document.createElement('div');
        ratingDiv.className = 'player-rating';
        slot.appendChild(ratingDiv);
    }
    ratingDiv.textContent = player.rating;
    closeModal();
    updateStats();
    showToast(`Added ${player.fullName} to lineup`);
}

function closeModal() {
    document.getElementById('playerModal').style.display = 'none';
    currentSlot = null;
}

function autoSelectPlayers() {
    const criteria = document.getElementById('autoSelectCriteria').value;
    const slots = document.querySelectorAll('.player-slot');
    const preferredPlayers = {
        'CB': ['Mohammed Salisu', 'Alexander Djiku'],
        'LB': ['Derrick Kohn'],
        'LWB': ['Derrick Kohn'],
        'RB': ['Caleb Yirenkyi'],
        'RWB': ['Caleb Yirenkyi']
    };
    const excludedPlayers = {
        'LB': ['Mohammed Salisu', 'Alexander Djiku'],
        'LWB': ['Mohammed Salisu', 'Alexander Djiku'],
        'RB': ['Mohammed Salisu', 'Alexander Djiku'],
        'RWB': ['Mohammed Salisu', 'Alexander Djiku']
    };
    slots.forEach(slot => {
        const pos = slot.querySelector('.player-name').textContent;
        if (!['GK', 'CB', 'LB', 'RB', 'LWB', 'RWB', 'DM', 'CM', 'AM', 'LM', 'RM', 'LW', 'RW', 'ST'].includes(pos)) return;
        const availablePlayers = getPlayersForPosition(pos);
        const usedPlayers = Object.values(selectedLineup).map(p => p.fullName);
        let filteredPlayers = availablePlayers.filter(p => !usedPlayers.includes(p.fullName));
        if (excludedPlayers[pos]) {
            filteredPlayers = filteredPlayers.filter(p => !excludedPlayers[pos].includes(p.fullName));
        }
        if (filteredPlayers.length === 0) return;
        let bestPlayer;
        if (preferredPlayers[pos]) {
            const prefList = preferredPlayers[pos];
            for (let prefName of prefList) {
                const prefPlayer = filteredPlayers.find(p => p.fullName === prefName);
                if (prefPlayer) {
                    bestPlayer = prefPlayer;
                    break;
                }
            }
        }
        if (!bestPlayer) {
            switch (criteria) {
                case 'form':
                    bestPlayer = filteredPlayers.sort((a, b) => b.form - a.form)[0];
                    break;
                case 'experience':
                    bestPlayer = filteredPlayers.sort((a, b) => b.caps - a.caps)[0];
                    break;
                case 'versatility':
                    bestPlayer = filteredPlayers.sort((a, b) => b.versatility - a.versatility)[0];
                    break;
                default:
                    bestPlayer = filteredPlayers[0];
            }
        }
        selectedLineup[slot.id] = bestPlayer;
        slot.classList.add('selected');
        const nameDiv = slot.querySelector('.player-name');
        nameDiv.textContent = bestPlayer.name;
        let ratingDiv = slot.querySelector('.player-rating');
        if (!ratingDiv) {
            ratingDiv = document.createElement('div');
            ratingDiv.className = 'player-rating';
            slot.appendChild(ratingDiv);
        }
        ratingDiv.textContent = bestPlayer.rating;
    });
    updateStats();
    showToast('Lineup auto-filled successfully!');
}

function updateStats() {
    const lineup = Object.values(selectedLineup);
    if (lineup.length === 0) {
        document.getElementById('avgRating').textContent = '0';
        document.getElementById('avgAge').textContent = '0';
        document.getElementById('totalCaps').textContent = '0';
        document.getElementById('attackScore').textContent = '0';
        document.getElementById('defenseScore').textContent = '0';
        document.getElementById('chemistryScore').textContent = '0';
        return;
    }
    const avgRating = (lineup.reduce((sum, p) => sum + p.rating, 0) / lineup.length).toFixed(1);
    const avgAge = (lineup.reduce((sum, p) => sum + p.age, 0) / lineup.length).toFixed(1);
    const totalCaps = lineup.reduce((sum, p) => sum + p.caps, 0);
    const attackers = lineup.filter(p => players.ATT.includes(p));
    const defenders = lineup.filter(p => players.DEF.includes(p));
    const attackScore = attackers.length > 0 ? (attackers.reduce((sum, p) => sum + p.rating, 0) / attackers.length).toFixed(0) : 0;
    const defenseScore = defenders.length > 0 ? (defenders.reduce((sum, p) => sum + p.rating, 0) / defenders.length).toFixed(0) : 0;
    const avgVersatility = (lineup.reduce((sum, p) => sum + p.versatility, 0) / lineup.length);
    const avgForm = (lineup.reduce((sum, p) => sum + p.form, 0) / lineup.length);
    const chemistryScore = Math.min(100, Math.round(avgVersatility * 8 + avgForm * 4 + (lineup.length >= 11 ? 20 : 0)));
    document.getElementById('avgRating').textContent = avgRating;
    document.getElementById('avgAge').textContent = avgAge;
    document.getElementById('totalCaps').textContent = totalCaps;
    document.getElementById('attackScore').textContent = attackScore;
    document.getElementById('defenseScore').textContent = defenseScore;
    document.getElementById('chemistryScore').textContent = chemistryScore;
}

async function exportAsImage() {
    const pitchContainer = document.querySelector('.pitch-container');
    try {
        const canvas = await html2canvas(pitchContainer, {
            backgroundColor: '#2d5a3d',
            scale: 2,
            logging: false
        });
        const link = document.createElement('a');
        link.download = `ghana-blackstars-lineup-${new Date().getTime()}.jpg`;
        link.href = canvas.toDataURL('image/jpeg', 0.95);
        link.click();
        showToast('Lineup exported as image!');
    } catch (e) {
        showToast('Export failed. Please try again.');
    }
}

async function exportAsPDF() {
    const pitchContainer = document.querySelector('.pitch-container');
    try {
        const canvas = await html2canvas(pitchContainer, {
            backgroundColor: '#2d5a3d',
            scale: 2,
            logging: false
        });
        const imgData = canvas.toDataURL('image/jpeg', 0.95);
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
            orientation: 'portrait',
            unit: 'mm',
            format: 'a4'
        });
        const imgWidth = 190;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        pdf.addImage(imgData, 'JPEG', 10, 10, imgWidth, imgHeight);
        const formation = document.getElementById('formationSelect').value;
        pdf.text(`Ghana Black Stars - ${formation}`, 105, imgHeight + 20, { align: 'center' });
        pdf.save(`ghana-blackstars-lineup-${new Date().getTime()}.pdf`);
        showToast('Lineup exported as PDF!');
    } catch (e) {
        showToast('Export failed. Please try again.');
    }
}

function openWorldCupBuilder() {
    const modal = document.getElementById('worldCupModal');
    const playerListContainer = document.getElementById('wcPlayerList');
    playerListContainer.innerHTML = '';
    const categories = [
        { name: 'Goalkeepers', key: 'GK', players: players.GK },
        { name: 'Defenders', key: 'DEF', players: players.DEF },
        { name: 'Midfielders', key: 'MID', players: players.MID.concat(players.VERSATILE) },
        { name: 'Attackers', key: 'ATT', players: players.ATT }
    ];
    categories.forEach(cat => {
        const catDiv = document.createElement('div');
        catDiv.style.cssText = 'margin-bottom:25px;';
        const heading = document.createElement('h3');
        heading.style.cssText = 'color:var(--primary-gold);margin-bottom:12px;font-size:1.15em;';
        heading.textContent = cat.name;
        catDiv.appendChild(heading);
        cat.players.forEach(player => {
            const playerDiv = document.createElement('div');
            const isSelected = worldCupSquad.includes(player.fullName);
            playerDiv.style.cssText = `
                background:${isSelected ? 'rgba(0,107,63,0.3)' : 'rgba(255,255,255,0.05)'};
                padding:14px;
                border-radius:10px;
                margin-bottom:10px;
                cursor:pointer;
                transition:all 0.3s ease;
                display:flex;
                justify-content:space-between;
                align-items:center;
                border:${isSelected ? '2px solid var(--accent-yellow)' : '2px solid transparent'};
            `;
            playerDiv.onmouseover = () => {
                if (!isSelected) playerDiv.style.background = 'rgba(212,175,55,0.2)';
            };
            playerDiv.onmouseout = () => {
                if (!isSelected) playerDiv.style.background = 'rgba(255,255,255,0.05)';
            };
            playerDiv.onclick = () => toggleWorldCupPlayer(player.fullName, playerDiv);
            playerDiv.innerHTML = `
                <div>
                    <span style="color:${isSelected ? 'var(--accent-yellow)' : 'var(--primary-gold)'};font-weight:bold;font-size:1.05em;">
                        ${isSelected ? '‚úì ' : ''}${player.fullName}
                    </span>
                    <span style="color:#aaa;font-size:0.9em;margin-left:10px;">${player.club}</span>
                </div>
                <div style="display:flex;gap:15px;align-items:center;">
                    <span style="color:#aaa;font-size:0.85em;">${player.age}y | ${player.caps} caps</span>
                    <div style="background:#000;color:var(--accent-yellow);padding:8px 14px;border-radius:6px;font-weight:bold;">${player.rating}</div>
                </div>
            `;
            catDiv.appendChild(playerDiv);
        });
        playerListContainer.appendChild(catDiv);
    });
    updateWCSquadCount();
    modal.style.display = 'flex';
}

function toggleWorldCupPlayer(fullName, element) {
    const index = worldCupSquad.indexOf(fullName);
    if (index > -1) {
        worldCupSquad.splice(index, 1);
        element.style.background = 'rgba(255,255,255,0.05)';
        element.style.border = '2px solid transparent';
        element.querySelector('span').textContent = element.querySelector('span').textContent.replace('‚úì ', '');
        element.querySelector('span').style.color = 'var(--primary-gold)';
    } else {
        if (worldCupSquad.length >= 26) {
            showToast('Maximum 26 players allowed!');
            return;
        }
        worldCupSquad.push(fullName);
        element.style.background = 'rgba(0,107,63,0.3)';
        element.style.border = '2px solid var(--accent-yellow)';
        element.querySelector('span').textContent = '‚úì ' + element.querySelector('span').textContent;
        element.querySelector('span').style.color = 'var(--accent-yellow)';
    }
    updateWCSquadCount();
}

function updateWCSquadCount() {
    const countElement = document.getElementById('wcSquadCount');
    const count = worldCupSquad.length;
    countElement.textContent = `${count} / 26 Selected`;
    if (count === 26) countElement.style.color = '#00ff00';
    else if (count > 26) countElement.style.color = '#ff4444';
    else countElement.style.color = 'var(--accent-yellow)';
}

function autoSelectWorldCup() {
    worldCupSquad = [];
    players.GK.sort((a, b) => b.rating - a.rating).slice(0, 3).forEach(p => worldCupSquad.push(p.fullName));
    players.DEF.sort((a, b) => b.rating - a.rating).slice(0, 8).forEach(p => worldCupSquad.push(p.fullName));
    const allMidfielders = players.MID.concat(players.VERSATILE).sort((a, b) => b.rating - a.rating);
    allMidfielders.slice(0, 7).forEach(p => worldCupSquad.push(p.fullName));
    players.ATT.sort((a, b) => b.rating - a.rating).slice(0, 8).forEach(p => worldCupSquad.push(p.fullName));
    openWorldCupBuilder();
    showToast('Best 26 players auto-selected!');
}

function saveWorldCupSquad() {
    if (worldCupSquad.length !== 26) {
        showToast(`Please select exactly 26 players. Currently: ${worldCupSquad.length}`);
        return;
    }
    currentSquadMode = 'worldcup';
    document.getElementById('squadMode').value = 'worldcup';
    updateSquadModeDisplay();
    closeWorldCupModal();
    renderFormation(document.getElementById('formationSelect').value);
    displayWorldCupSquad();
    showToast('World Cup squad saved!');
}

function closeWorldCupModal() {
    document.getElementById('worldCupModal').style.display = 'none';
}

function updateSquadModeDisplay() {
    const headerText = document.querySelector('header .subtitle');
    const squadModeSelect = document.getElementById('squadMode');
    if (currentSquadMode === 'worldcup') {
        headerText.textContent = `Tactical Lineup Builder - World Cup Squad (${worldCupSquad.length}/26 Players)`;
        headerText.style.color = 'var(--accent-yellow)';
        squadModeSelect.options[1].text = `World Cup Squad (${worldCupSquad.length}/26 selected)`;
    } else {
        headerText.textContent = 'Ultimate Tactical Lineup Builder - World Cup Ready';
        headerText.style.color = 'var(--text-primary)';
        squadModeSelect.options[1].text = `World Cup Squad (${worldCupSquad.length}/26 selected)`;
    }
}

function applyColorTheme(theme) {
    const themes = {
        classic: {
            unselected: 'linear-gradient(135deg, var(--primary-gold) 0%, var(--accent-yellow) 100%)',
            selected: 'linear-gradient(135deg, var(--primary-red) 0%, #ff4444 100%)',
            unselectedText: '#000',
            selectedText: '#fff',
            border: '#1a472a',
            selectedBorder: '#fff'
        },
        red: {
            unselected: 'linear-gradient(135deg, #fff 0%, #f0f0f0 100%)',
            selected: 'linear-gradient(135deg, var(--primary-red) 0%, #8b0000 100%)',
            unselectedText: '#000',
            selectedText: '#fff',
            border: 'var(--primary-red)',
            selectedBorder: '#fff'
        },
        green: {
            unselected: 'linear-gradient(135deg, var(--primary-gold) 0%, #b8941e 100%)',
            selected: 'linear-gradient(135deg, var(--primary-green) 0%, #004d2d 100%)',
            unselectedText: '#000',
            selectedText: 'var(--accent-yellow)',
            border: 'var(--primary-green)',
            selectedBorder: 'var(--accent-yellow)'
        },
        black: {
            unselected: 'linear-gradient(135deg, var(--primary-gold) 0%, var(--accent-yellow) 100%)',
            selected: 'linear-gradient(135deg, #1a1a1a 0%, #000 100%)',
            unselectedText: '#000',
            selectedText: 'var(--primary-gold)',
            border: '#000',
            selectedBorder: 'var(--primary-gold)'
        },
        blue: {
            unselected: 'linear-gradient(135deg, #fff 0%, #e8e8e8 100%)',
            selected: 'linear-gradient(135deg, #0066cc 0%, #003d7a 100%)',
            unselectedText: '#000',
            selectedText: '#fff',
            border: '#0066cc',
            selectedBorder: '#fff'
        }
    };
    const selectedTheme = themes[theme];
    const style = document.createElement('style');
    style.id = 'dynamic-theme';
    const existingStyle = document.getElementById('dynamic-theme');
    if (existingStyle) existingStyle.remove();
    style.textContent = `
        .player-slot { 
            background: ${selectedTheme.unselected} !important; 
            border-color: ${selectedTheme.border} !important; 
        }
        .player-slot .player-name { 
            color: ${selectedTheme.unselectedText} !important; 
        }
        .player-slot.selected { 
            background: ${selectedTheme.selected} !important; 
            border-color: ${selectedTheme.selectedBorder} !important; 
        }
        .player-slot.selected .player-name { 
            color: ${selectedTheme.selectedText} !important; 
        }
    `;
    document.head.appendChild(style);
    showToast(`Theme changed to ${theme}`);
}

function calculateFormationPower() {
    const formationScores = [];
    for (let formationName in formations) {
        const formation = formations[formationName];
        let totalPower = 0;
        let positionCount = 0;
        let attackPower = 0;
        let defensePower = 0;
        let midPower = 0;
        let depthScore = 0;
        let versatilityBonus = 0;
        formation.lines.forEach(line => {
            line.positions.forEach(pos => {
                positionCount++;
                const bestPlayers = getPlayersForPosition(pos).slice(0, 3);
                if (bestPlayers.length > 0) {
                    const topPlayer = bestPlayers[0];
                    totalPower += topPlayer.rating;
                    if (['ST', 'LW', 'RW'].includes(pos)) attackPower += topPlayer.rating;
                    else if (['CB', 'LB', 'RB', 'LWB', 'RWB'].includes(pos)) defensePower += topPlayer.rating;
                    else midPower += topPlayer.rating;
                    if (bestPlayers.length >= 2) depthScore += (bestPlayers[1].rating * 0.3);
                    if (bestPlayers.length >= 3) depthScore += (bestPlayers[2].rating * 0.15);
                    if (topPlayer.versatility >= 7) versatilityBonus += 2;
                }
            });
        });
        const avgRating = totalPower / positionCount;
        const balanceScore = Math.min(attackPower, defensePower, midPower) / 10;
        const formationScore = avgRating + (depthScore / positionCount) + balanceScore + versatilityBonus;
        let tacticalBonus = 0;
        if (['4-3-3', '4-2-3-1', '3-4-3'].includes(formationName)) tacticalBonus += 2;
        if (['4-3-3', '4-2-3-1', '4-4-2'].includes(formationName)) tacticalBonus += 1.5;
        if (['4-2-3-1', '4-1-4-1', '4-3-3'].includes(formationName)) tacticalBonus += 1;
        const attackingPositions = formation.lines.flatMap(l => l.positions.filter(p => ['ST', 'LW', 'RW'].includes(p)));
        const defensivePositions = formation.lines.flatMap(l => l.positions.filter(p => ['CB', 'LB', 'RB', 'LWB', 'RWB'].includes(p)));
        formationScores.push({
            name: formationName,
            score: formationScore + tacticalBonus,
            avgRating: avgRating.toFixed(1),
            attack: (attackPower / Math.max(1, attackingPositions.length)).toFixed(0),
            defense: (defensePower / Math.max(1, defensivePositions.length)).toFixed(0),
            depth: depthScore.toFixed(1),
            versatility: versatilityBonus.toFixed(0)
        });
    }
    formationScores.sort((a, b) => b.score - a.score);
    displayFormationRankings(formationScores);
}

function displayFormationRankings(rankings) {
    const container = document.getElementById('formationRankings');
    container.innerHTML = '';
    rankings.forEach((formation, index) => {
        const rankDiv = document.createElement('div');
        rankDiv.style.cssText = `
            background:rgba(255,255,255,0.1);
            padding:18px;
            border-radius:12px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            transition:all 0.3s ease;
            cursor:pointer;
            border-left:4px solid ${index === 0 ? 'var(--primary-gold)' : index === 1 ? '#c0c0c0' : index === 2 ? '#cd7f32' : 'rgba(255,255,255,0.3)'};
        `;
        rankDiv.onmouseover = () => rankDiv.style.background = 'rgba(212,175,55,0.2)';
        rankDiv.onmouseout = () => rankDiv.style.background = 'rgba(255,255,255,0.1)';
        rankDiv.onclick = () => {
            document.getElementById('formationSelect').value = formation.name;
            renderFormation(formation.name);
            window.scrollTo({ top: 0, behavior: 'smooth' });
            showToast(`Switched to ${formation.name}`);
        };
        const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
        rankDiv.innerHTML = `
            <div style="flex:1;">
                <div style="font-size:1.25em;font-weight:bold;color:var(--primary-gold);margin-bottom:6px;">
                    ${medal} ${formation.name}
                </div>
                <div style="font-size:0.9em;opacity:0.8;">
                    Power: ${formation.score.toFixed(1)} | Avg: ${formation.avgRating} | ATT: ${formation.attack} | DEF: ${formation.defense}
                </div>
            </div>
            <div style="font-size:1.6em;font-weight:bold;color:var(--accent-yellow);">
                ${formation.score.toFixed(1)}
            </div>
        `;
        container.appendChild(rankDiv);
    });
}

function displayWorldCupSquad() {
    const container = document.getElementById('worldCupSquad');
    container.innerHTML = '';
    if (worldCupSquad.length === 0) {
        container.innerHTML = `
            <div style="grid-column:1/-1;text-align:center;padding:40px;opacity:0.6;">
                <p style="font-size:1.1em;margin-bottom:10px;">No World Cup squad selected yet.</p>
                <p>Use the "Build WC Squad" button above to create your 26-man roster.</p>
            </div>
        `;
        return;
    }
    const allPlayers = [].concat(players.GK, players.DEF, players.MID, players.VERSATILE, players.ATT);
    const squadPlayers = allPlayers.filter(p => worldCupSquad.includes(p.fullName));
    const positions = [
        { name: 'Goalkeepers', players: squadPlayers.filter(p => players.GK.includes(p)) },
        { name: 'Defenders', players: squadPlayers.filter(p => players.DEF.includes(p)) },
        { name: 'Midfielders', players: squadPlayers.filter(p => players.MID.includes(p) || players.VERSATILE.includes(p)) },
        { name: 'Attackers', players: squadPlayers.filter(p => players.ATT.includes(p)) }
    ];
    positions.forEach(category => {
        if (category.players.length > 0) {
            const posDiv = document.createElement('div');
            posDiv.style.cssText = 'background:rgba(255,255,255,0.05);padding:18px;border-radius:12px;';
            const title = document.createElement('h3');
            title.style.cssText = 'color:var(--accent-yellow);font-size:1.05em;margin-bottom:12px;text-transform:uppercase;letter-spacing:1px;';
            title.textContent = `${category.name} (${category.players.length})`;
            posDiv.appendChild(title);
            category.players.forEach(player => {
                const playerLineDiv = document.createElement('div');
                playerLineDiv.style.cssText = `
                    padding:10px 0;
                    border-bottom:1px solid rgba(255,255,255,0.1);
                    display:flex;
                    justify-content:space-between;
                    align-items:center;
                `;
                playerLineDiv.innerHTML = `
                    <div>
                        <span style="color:var(--primary-gold);font-weight:bold;">${player.name}</span>
                        <span style="color:#aaa;font-size:0.9em;margin-left:10px;">${player.club}</span>
                    </div>
                    <div style="background:#000;color:var(--accent-yellow);padding:5px 12px;border-radius:6px;font-weight:bold;font-size:0.95em;">
                        ${player.rating}
                    </div>
                `;
                posDiv.appendChild(playerLineDiv);
            });
            container.appendChild(posDiv);
        }
    });
    const countDiv = document.createElement('div');
    countDiv.style.cssText = `
        grid-column:1/-1;
        text-align:center;
        padding:20px;
        background:rgba(212,175,55,0.15);
        border-radius:12px;
        font-size:1.25em;
        font-weight:bold;
        color:var(--accent-yellow);
        margin-top:15px;
    `;
    countDiv.innerHTML = `Total Squad: ${worldCupSquad.length} / 26 Players`;
    container.appendChild(countDiv);
}

function clearLineup() {
    if (!confirm('Are you sure you want to clear the lineup?')) return;
    selectedLineup = {};
    const slots = document.querySelectorAll('.player-slot');
    slots.forEach(slot => {
        slot.classList.remove('selected');
        const pos = slot.id.split('-')[0];
        slot.querySelector('.player-name').textContent = pos;
        const rating = slot.querySelector('.player-rating');
        if (rating) rating.remove();
    });
    updateStats();
    showToast('Lineup cleared!');
}

function randomizeLineup() {
    clearLineup();
    const slots = document.querySelectorAll('.player-slot');
    slots.forEach(slot => {
        const pos = slot.querySelector('.player-name').textContent;
        if (!['GK', 'CB', 'LB', 'RB', 'LWB', 'RWB', 'DM', 'CM', 'AM', 'LM', 'RM', 'LW', 'RW', 'ST'].includes(pos)) return;
        const availablePlayers = getPlayersForPosition(pos);
        const usedPlayers = Object.values(selectedLineup).map(p => p.fullName);
        const filteredPlayers = availablePlayers.filter(p => !usedPlayers.includes(p.fullName));
        if (filteredPlayers.length === 0) return;
        const randomPlayer = filteredPlayers[Math.floor(Math.random() * Math.min(5, filteredPlayers.length))];
        selectedLineup[slot.id] = randomPlayer;
        slot.classList.add('selected');
        slot.querySelector('.player-name').textContent = randomPlayer.name;
        let ratingDiv = slot.querySelector('.player-rating');
        if (!ratingDiv) {
            ratingDiv = document.createElement('div');
            ratingDiv.className = 'player-rating';
            slot.appendChild(ratingDiv);
        }
        ratingDiv.textContent = randomPlayer.rating;
    });
    updateStats();
    showToast('Lineup randomized!');
}

function showToast(message) {
    const existingToast = document.querySelector('.toast');
    if (existingToast) existingToast.remove();
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => {
        toast.style.animation = 'slideInRight 0.4s ease-out reverse';
        setTimeout(() => toast.remove(), 400);
    }, 3000);
}

document.getElementById('formationSelect').addEventListener('change', e => renderFormation(e.target.value));
document.getElementById('colorTheme').addEventListener('change', e => applyColorTheme(e.target.value));
document.getElementById('squadMode').addEventListener('change', e => {
    if (e.target.value === 'worldcup' && worldCupSquad.length === 0) {
        showToast('Please build your World Cup squad first!');
        e.target.value = 'full';
        return;
    }
    currentSquadMode = e.target.value;
    renderFormation(document.getElementById('formationSelect').value);
    updateSquadModeDisplay();
});

renderFormation('4-3-3');
calculateFormationPower();
displayWorldCupSquad();
    </script>
</body>
</html>