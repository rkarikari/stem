<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghana Black Stars Lineup Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a472a 0%, #0d2818 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .flag-colors {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 10px;
        }

        .flag-colors div {
            width: 60px;
            height: 8px;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        select, button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }

        button {
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            color: #1a472a;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
        }

        .pitch-container {
            background: linear-gradient(to bottom, #2d5a3d 0%, #1a3d2a 100%);
            border-radius: 15px;
            padding: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            margin-bottom: 30px;
        }

        .pitch {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            aspect-ratio: 0.7;
            background: 
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 49.5%,
                    rgba(255,255,255,0.1) 49.5%,
                    rgba(255,255,255,0.1) 50.5%,
                    transparent 50.5%
                ),
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 19.5%,
                    rgba(255,255,255,0.1) 19.5%,
                    rgba(255,255,255,0.1) 20.5%,
                    transparent 20.5%
                );
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 10px;
        }

        .pitch::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(255,255,255,0.3);
        }

        .pitch::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
        }

        .formation-line {
            position: absolute;
            width: 100%;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
        }

        .player-slot {
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            border: 4px solid #1a472a;
            border-radius: 50%;
            width: 95px;
            height: 95px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .player-slot:hover {
            transform: scale(1.15);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.6);
            z-index: 10;
        }

        .player-slot.selected {
            background: linear-gradient(135deg, #ce1126 0%, #ff4444 100%);
            border-color: #fff;
        }

        .player-name {
            font-size: 0.75em;
            font-weight: 900;
            text-align: center;
            color: #000;
            margin-top: 2px;
            text-shadow: 0 0 3px rgba(255,255,255,0.8);
            line-height: 1.1;
            padding: 0 4px;
        }

        .player-slot.selected .player-name {
            color: #fff;
            text-shadow: 0 0 4px rgba(0,0,0,0.9), 0 2px 4px rgba(0,0,0,0.8);
        }

        .player-rating {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #000;
            color: #fcd116;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
            font-weight: 900;
            border: 3px solid #fcd116;
            box-shadow: 0 2px 8px rgba(0,0,0,0.6);
        }

        .player-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a472a 0%, #0d2818 100%);
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .modal-content h2 {
            color: #d4af37;
            margin-bottom: 20px;
            text-align: center;
        }

        .player-list {
            display: grid;
            gap: 10px;
        }

        .player-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-item:hover {
            background: rgba(212, 175, 55, 0.2);
            transform: translateX(5px);
        }

        .player-info {
            flex: 1;
        }

        .player-info strong {
            color: #d4af37;
            display: block;
            margin-bottom: 5px;
        }

        .player-info small {
            color: #aaa;
            font-size: 0.85em;
        }

        .stats-panel {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            backdrop-filter: blur(10px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        .stat-value {
            font-size: 2em;
            color: #d4af37;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.85em;
            margin-top: 5px;
            opacity: 0.8;
        }

        .close-modal {
            background: #ce1126;
            color: white;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            h1 { font-size: 1.8em; }
            .player-slot {
                width: 70px;
                height: 70px;
            }
            .player-name {
                font-size: 0.65em;
            }
            .player-rating {
                width: 26px;
                height: 26px;
                font-size: 0.75em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ‡¬ðŸ‡­ GHANA BLACK STARS</h1>
            <p>Tactical Lineup Builder</p>
            <div class="flag-colors">
                <div style="background: #ce1126;"></div>
                <div style="background: #fcd116;"></div>
                <div style="background: #006b3f;"></div>
            </div>
        </header>

        <div class="controls">
            <div class="control-group">
                <label>Formation</label>
                <select id="formationSelect">
                    <option value="4-3-3">4-3-3 (Attacking)</option>
                    <option value="4-2-3-1">4-2-3-1 (Balanced)</option>
                    <option value="4-4-2">4-4-2 (Classic)</option>
                    <option value="3-5-2">3-5-2 (Defensive)</option>
                    <option value="4-1-4-1">4-1-4-1 (Possession)</option>
                    <option value="3-4-3">3-4-3 (Ultra Attack)</option>
                    <option value="5-3-2">5-3-2 (Counter)</option>
                    <option value="4-4-2-diamond">4-4-2 Diamond</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>Auto-Select by</label>
                <select id="autoSelectCriteria">
                    <option value="rating">Overall Rating</option>
                    <option value="form">Current Form</option>
                    <option value="experience">Experience</option>
                    <option value="versatility">Versatility</option>
                </select>
                <button onclick="autoSelectPlayers()">Auto-Fill Lineup</button>
            </div>

            <div class="control-group">
                <label>Color Theme</label>
                <select id="colorTheme">
                    <option value="classic">Classic Gold</option>
                    <option value="red">Red & White</option>
                    <option value="green">Green & Gold</option>
                    <option value="black">Black & Gold</option>
                    <option value="blue">Blue & White</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>Export Options</label>
                <button onclick="exportAsImage()">ðŸ“¸ Export as JPG</button>
                <button onclick="exportAsPDF()">ðŸ“„ Export as PDF</button>
            </div>
        </div>

        <div class="pitch-container">
            <div class="pitch" id="pitch"></div>
        </div>

        <div class="stats-panel">
            <h2 style="color: #d4af37; margin-bottom: 15px;">Team Statistics</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="avgRating">0</div>
                    <div class="stat-label">Average Rating</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="avgAge">0</div>
                    <div class="stat-label">Average Age</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalCaps">0</div>
                    <div class="stat-label">Total Caps</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="attackScore">0</div>
                    <div class="stat-label">Attack Power</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="defenseScore">0</div>
                    <div class="stat-label">Defense Power</div>
                </div>
            </div>
        </div>
    </div>

    <div class="player-modal" id="playerModal">
        <div class="modal-content">
            <h2>Select Player</h2>
            <div class="player-list" id="playerList"></div>
            <button class="close-modal" onclick="closeModal()">Close</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script>
        const players = {
            GK: [
                {name: 'Ati-Zigi', fullName: 'Lawrence Ati-Zigi', club: 'St. Gallen', rating: 78, age: 27, caps: 16, form: 8, versatility: 1},
                {name: 'Nurudeen', fullName: 'Abdul Manaf Nurudeen', club: 'KAS Eupen', rating: 75, age: 25, caps: 5, form: 7, versatility: 1},
                {name: 'Asare', fullName: 'Benjamin Asare', club: 'Hearts of Oak', rating: 72, age: 24, caps: 2, form: 8, versatility: 1},
                {name: 'Anang', fullName: 'Joseph Anang', club: "St Patrick's", rating: 73, age: 23, caps: 1, form: 7, versatility: 1}
            ],
            DEF: [
                {name: 'Salisu', fullName: 'Mohammed Salisu', club: 'Monaco', rating: 82, age: 25, caps: 18, form: 9, versatility: 7, positions: ['CB', 'LB']},
                {name: 'Djiku', fullName: 'Alexander Djiku', club: 'Fenerbahce', rating: 81, age: 29, caps: 35, form: 8, versatility: 7, positions: ['CB', 'RB']},
                {name: 'Lamptey', fullName: 'Tariq Lamptey', club: 'Brighton', rating: 80, age: 23, caps: 12, form: 8, versatility: 6, positions: ['RB', 'RW']},
                {name: 'Seidu', fullName: 'Alidu Seidu', club: 'Stade Rennes', rating: 78, age: 24, caps: 20, form: 8, versatility: 7, positions: ['RB', 'CB']},
                {name: 'Mensah', fullName: 'Gideon Mensah', club: 'Bordeaux', rating: 76, age: 26, caps: 15, form: 7, versatility: 5, positions: ['LB']},
                {name: 'Kohn', fullName: 'Derrick Kohn', club: 'Galatasaray', rating: 77, age: 25, caps: 8, form: 8, versatility: 6, positions: ['LB', 'LWB']},
                {name: 'Ambrosius', fullName: 'Stephan Ambrosius', club: 'St. Gallen', rating: 77, age: 25, caps: 8, form: 7, versatility: 6, positions: ['CB']},
                {name: 'Adjei', fullName: 'Nathaniel Adjei', club: 'FC Lorient', rating: 75, age: 24, caps: 3, form: 7, versatility: 5, positions: ['CB']},
                {name: 'Simpson', fullName: 'Razak Simpson', club: 'Nations FC', rating: 73, age: 23, caps: 4, form: 8, versatility: 6, positions: ['RB', 'CB']}
            ],
            MID: [
                {name: 'Partey', fullName: 'Thomas Partey', club: 'Arsenal', rating: 85, age: 31, caps: 54, form: 8, versatility: 7, positions: ['DM', 'CM']},
                {name: 'Kudus', fullName: 'Mohammed Kudus', club: 'West Ham', rating: 83, age: 24, caps: 28, form: 9, versatility: 9, positions: ['AM', 'RW', 'ST', 'CM']},
                {name: 'Ashimeru', fullName: 'Majeed Ashimeru', club: 'Anderlecht', rating: 77, age: 27, caps: 22, form: 7, versatility: 6, positions: ['CM', 'DM']},
                {name: 'E. Addo', fullName: 'Edmund Addo', club: 'Sheriff', rating: 76, age: 24, caps: 11, form: 7, versatility: 5, positions: ['DM']},
                {name: 'Samed', fullName: 'Salis Abdul Samed', club: 'Sunderland', rating: 78, age: 24, caps: 15, form: 8, versatility: 6, positions: ['DM', 'CM']},
                {name: 'Sulemana I.', fullName: 'Ibrahim Sulemana', club: 'Atalanta', rating: 76, age: 21, caps: 6, form: 7, versatility: 6, positions: ['CM']},
                {name: 'Sibo', fullName: 'Kwasi Sibo', club: 'Hearts of Oak', rating: 74, age: 22, caps: 5, form: 8, versatility: 6, positions: ['CM', 'DM']},
                {name: 'Diomande', fullName: 'Mohamed Diomande', club: 'Rangers', rating: 74, age: 22, caps: 3, form: 8, versatility: 7, positions: ['CM', 'DM']},
                {name: 'Mamudu', fullName: 'Kamaradini Mamudu', club: 'Medeama SC', rating: 71, age: 22, caps: 3, form: 7, versatility: 6, positions: ['CM']}
            ],
            VERSATILE: [
                {name: 'Yirenkyi', fullName: 'Caleb Yirenkyi', club: 'Nordsjaelland', rating: 72, age: 19, caps: 2, form: 8, versatility: 8, positions: ['CM', 'AM', 'RB', 'RW']}
            ],
            ATT: [
                {name: 'J. Ayew', fullName: 'Jordan Ayew', club: 'Leicester', rating: 80, age: 33, caps: 114, form: 8, versatility: 8, positions: ['ST', 'RW', 'LW']},
                {name: 'I. Williams', fullName: 'Inaki Williams', club: 'Athletic Bilbao', rating: 82, age: 30, caps: 20, form: 9, versatility: 7, positions: ['ST', 'RW']},
                {name: 'Semenyo', fullName: 'Antoine Semenyo', club: 'Bournemouth', rating: 81, age: 25, caps: 14, form: 9, versatility: 7, positions: ['ST', 'RW']},
                {name: 'Thomas-Asante', fullName: 'Brandon Thomas-Asante', club: 'Coventry City', rating: 78, age: 26, caps: 7, form: 9, versatility: 6, positions: ['ST', 'RW']},
                {name: 'Fatawu', fullName: 'Abdul Fatawu Issahaku', club: 'Leicester', rating: 79, age: 20, caps: 20, form: 8, versatility: 7, positions: ['RW', 'LW']},
                {name: 'Sulemana K.', fullName: 'Kamaldeen Sulemana', club: 'Southampton', rating: 78, age: 22, caps: 15, form: 7, versatility: 8, positions: ['LW', 'RW', 'ST']},
                {name: 'Nuamah', fullName: 'Ernest Nuamah', club: 'Lyon', rating: 77, age: 21, caps: 10, form: 8, versatility: 7, positions: ['RW', 'LW']},
                {name: 'Adu Kwabena', fullName: 'Prince Kwabena Adu', club: 'Viktoria Plzen', rating: 75, age: 22, caps: 2, form: 8, versatility: 7, positions: ['ST', 'RW', 'LW']},
                {name: 'Afriyie', fullName: 'Jerry Afriyie', club: 'Hellas Verona', rating: 74, age: 20, caps: 3, form: 8, versatility: 6, positions: ['ST']},
                {name: 'Afena-Gyan', fullName: 'Felix Afena-Gyan', club: 'Juventus NG', rating: 73, age: 21, caps: 5, form: 7, versatility: 6, positions: ['ST']},
                {name: 'Opoku', fullName: 'Kwame Opoku', club: 'Asante Kotoko', rating: 72, age: 23, caps: 2, form: 7, versatility: 5, positions: ['ST']},
                {name: 'Fuseini', fullName: 'Mohammed Fuseini', club: 'Union SG', rating: 71, age: 22, caps: 1, form: 7, versatility: 6, positions: ['LW', 'ST']}
            ]
        };

        const formations = {
            '4-3-3': {
                lines: [
                    {positions: ['GK'], y: 95},
                    {positions: ['LB', 'CB', 'CB', 'RB'], y: 75},
                    {positions: ['CM', 'CM', 'CM'], y: 50},
                    {positions: ['LW', 'ST', 'RW'], y: 20}
                ]
            },
            '4-2-3-1': {
                lines: [
                    {positions: ['GK'], y: 95},
                    {positions: ['LB', 'CB', 'CB', 'RB'], y: 75},
                    {positions: ['DM', 'DM'], y: 60},
                    {positions: ['LW', 'AM', 'RW'], y: 38},
                    {positions: ['ST'], y: 15}
                ]
            },
            '4-4-2': {
                lines: [
                    {positions: ['GK'], y: 95},
                    {positions: ['LB', 'CB', 'CB', 'RB'], y: 75},
                    {positions: ['LM', 'CM', 'CM', 'RM'], y: 50},
                    {positions: ['ST', 'ST'], y: 20}
                ]
            },
            '3-5-2': {
                lines: [
                    {positions: ['GK'], y: 95},
                    {positions: ['CB', 'CB', 'CB'], y: 75},
                    {positions: ['LWB', 'CM', 'DM', 'CM', 'RWB'], y: 50},
                    {positions: ['ST', 'ST'], y: 20}
                ]
            },
            '4-1-4-1': {
                lines: [
                    {positions: ['GK'], y: 95},
                    {positions: ['LB', 'CB', 'CB', 'RB'], y: 75},
                    {positions: ['DM'], y: 62},
                    {positions: ['LM', 'CM', 'CM', 'RM'], y: 42},
                    {positions: ['ST'], y: 15}
                ]
            },
            '3-4-3': {
                lines: [
                    {positions: ['GK'], y: 95},
                    {positions: ['CB', 'CB', 'CB'], y: 75},
                    {positions: ['LM', 'CM', 'CM', 'RM'], y: 50},
                    {positions: ['LW', 'ST', 'RW'], y: 20}
                ]
            },
            '5-3-2': {
                lines: [
                    {positions: ['GK'], y: 95},
                    {positions: ['LWB', 'CB', 'CB', 'CB', 'RWB'], y: 75},
                    {positions: ['CM', 'DM', 'CM'], y: 50},
                    {positions: ['ST', 'ST'], y: 20}
                ]
            },
            '4-4-2-diamond': {
                lines: [
                    {positions: ['GK'], y: 95},
                    {positions: ['LB', 'CB', 'CB', 'RB'], y: 75},
                    {positions: ['DM'], y: 62},
                    {positions: ['CM', 'CM'], y: 50},
                    {positions: ['AM'], y: 32},
                    {positions: ['ST', 'ST'], y: 15}
                ]
            }
        };

        let selectedLineup = {};
        let currentSlot = null;

        function renderFormation(formationName) {
            const pitch = document.getElementById('pitch');
            pitch.innerHTML = '';
            selectedLineup = {};
            
            const formation = formations[formationName];
            
            formation.lines.forEach((line, lineIndex) => {
                const lineDiv = document.createElement('div');
                lineDiv.className = 'formation-line';
                lineDiv.style.top = line.y + '%';
                
                line.positions.forEach((position, posIndex) => {
                    const slot = document.createElement('div');
                    slot.className = 'player-slot';
                    const slotId = `${position}-${lineIndex}-${posIndex}`;
                    slot.id = slotId;
                    slot.onclick = () => openPlayerSelection(slotId, position);
                    
                    const nameDiv = document.createElement('div');
                    nameDiv.className = 'player-name';
                    nameDiv.textContent = position;
                    
                    slot.appendChild(nameDiv);
                    lineDiv.appendChild(slot);
                });
                
                pitch.appendChild(lineDiv);
            });
            
            updateStats();
        }

        function openPlayerSelection(slotId, position) {
            currentSlot = {id: slotId, position: position};
            const modal = document.getElementById('playerModal');
            const playerList = document.getElementById('playerList');
            playerList.innerHTML = '';
            
            const availablePlayers = getPlayersForPosition(position);
            
            availablePlayers.forEach(player => {
                const item = document.createElement('div');
                item.className = 'player-item';
                item.onclick = () => selectPlayer(player);
                
                item.innerHTML = `
                    <div class="player-info">
                        <strong>${player.fullName}</strong>
                        <small>${player.club} | ${player.age}y | ${player.caps} caps</small>
                    </div>
                    <div class="player-rating" style="position: static; width: 40px; height: 40px; font-size: 1.1em;">
                        ${player.rating}
                    </div>
                `;
                
                playerList.appendChild(item);
            });
            
            modal.style.display = 'flex';
        }

        function getPlayersForPosition(position) {
            let positionMap = {
                'GK': ['GK'],
                'CB': ['DEF'],
                'LB': ['DEF'],
                'RB': ['DEF', 'VERSATILE'],
                'LWB': ['DEF'],
                'RWB': ['DEF'],
                'DM': ['MID'],
                'CM': ['MID', 'VERSATILE'],
                'AM': ['MID', 'VERSATILE'],
                'LM': ['MID'],
                'RM': ['MID', 'VERSATILE'],
                'LW': ['ATT'],
                'RW': ['ATT', 'VERSATILE'],
                'ST': ['ATT']
            };
            
            let category = positionMap[position];
            let allPlayers = [];
            
            category.forEach(cat => {
                if (players[cat]) {
                    allPlayers = allPlayers.concat(players[cat]);
                }
            });
            
            return allPlayers.filter(p => {
                if (position === 'GK') return true;
                if (!p.positions) return true;
                
                const posMap = {
                    'CB': ['CB'], 'LB': ['LB'], 'RB': ['RB'],
                    'LWB': ['LB', 'LWB'], 'RWB': ['RB', 'RWB'],
                    'DM': ['DM'], 'CM': ['CM', 'DM'], 'AM': ['AM', 'CM'],
                    'LM': ['LW', 'LM', 'CM'], 'RM': ['RW', 'RM', 'CM'],
                    'LW': ['LW', 'RW'], 'RW': ['RW', 'LW'], 'ST': ['ST']
                };
                
                return posMap[position]?.some(p1 => p.positions.includes(p1)) || p.versatility >= 7;
            }).sort((a, b) => b.rating - a.rating);
        }

        function selectPlayer(player) {
            if (!currentSlot) return;
            
            selectedLineup[currentSlot.id] = player;
            
            const slot = document.getElementById(currentSlot.id);
            slot.classList.add('selected');
            
            const nameDiv = slot.querySelector('.player-name');
            nameDiv.textContent = player.name;
            
            let ratingDiv = slot.querySelector('.player-rating');
            if (!ratingDiv) {
                ratingDiv = document.createElement('div');
                ratingDiv.className = 'player-rating';
                slot.appendChild(ratingDiv);
            }
            ratingDiv.textContent = player.rating;
            
            closeModal();
            updateStats();
        }

        function closeModal() {
            document.getElementById('playerModal').style.display = 'none';
            currentSlot = null;
        }

        function autoSelectPlayers() {
            const criteria = document.getElementById('autoSelectCriteria').value;
            const slots = document.querySelectorAll('.player-slot');
            
            // Define preferred players for specific positions
            const preferredPlayers = {
                'CB': ['Mohammed Salisu', 'Alexander Djiku'],
                'LB': ['Derrick Kohn'],
                'LWB': ['Derrick Kohn'],
                'RB': ['Caleb Yirenkyi'],
                'RWB': ['Caleb Yirenkyi']
            };
            
            // Define players to exclude from certain positions
            const positionExclusions = {
                'LB': ['Mohammed Salisu', 'Alexander Djiku'],
                'LWB': ['Mohammed Salisu', 'Alexander Djiku'],
                'RB': ['Mohammed Salisu', 'Alexander Djiku'],
                'RWB': ['Mohammed Salisu', 'Alexander Djiku']
            };
            
            slots.forEach(slot => {
                const position = slot.querySelector('.player-name').textContent;
                if (!['GK', 'CB', 'LB', 'RB', 'LWB', 'RWB', 'DM', 'CM', 'AM', 'LM', 'RM', 'LW', 'RW', 'ST'].includes(position)) {
                    return;
                }
                
                const availablePlayers = getPlayersForPosition(position);
                const usedPlayers = Object.values(selectedLineup).map(p => p.fullName);
                let available = availablePlayers.filter(p => !usedPlayers.includes(p.fullName));
                
                // Exclude certain players from specific positions
                if (positionExclusions[position]) {
                    available = available.filter(p => !positionExclusions[position].includes(p.fullName));
                }
                
                if (available.length === 0) return;
                
                let bestPlayer;
                
                // Check if there's a preferred player for this position
                if (preferredPlayers[position]) {
                    const preferredList = preferredPlayers[position];
                    for (let preferredName of preferredList) {
                        const preferred = available.find(p => p.fullName === preferredName);
                        if (preferred) {
                            bestPlayer = preferred;
                            break;
                        }
                    }
                }
                
                // If no preferred player found or not a preferred position, use criteria
                if (!bestPlayer) {
                    switch(criteria) {
                        case 'form':
                            bestPlayer = available.sort((a, b) => b.form - a.form)[0];
                            break;
                        case 'experience':
                            bestPlayer = available.sort((a, b) => b.caps - a.caps)[0];
                            break;
                        case 'versatility':
                            bestPlayer = available.sort((a, b) => b.versatility - a.versatility)[0];
                            break;
                        default:
                            bestPlayer = available[0];
                    }
                }
                
                selectedLineup[slot.id] = bestPlayer;
                slot.classList.add('selected');
                
                const nameDiv = slot.querySelector('.player-name');
                nameDiv.textContent = bestPlayer.name;
                
                let ratingDiv = slot.querySelector('.player-rating');
                if (!ratingDiv) {
                    ratingDiv = document.createElement('div');
                    ratingDiv.className = 'player-rating';
                    slot.appendChild(ratingDiv);
                }
                ratingDiv.textContent = bestPlayer.rating;
            });
            
            updateStats();
        }

        function updateStats() {
            const lineup = Object.values(selectedLineup);
            
            if (lineup.length === 0) {
                document.getElementById('avgRating').textContent = '0';
                document.getElementById('avgAge').textContent = '0';
                document.getElementById('totalCaps').textContent = '0';
                document.getElementById('attackScore').textContent = '0';
                document.getElementById('defenseScore').textContent = '0';
                return;
            }
            
            const avgRating = (lineup.reduce((sum, p) => sum + p.rating, 0) / lineup.length).toFixed(1);
            const avgAge = (lineup.reduce((sum, p) => sum + p.age, 0) / lineup.length).toFixed(1);
            const totalCaps = lineup.reduce((sum, p) => sum + p.caps, 0);
            
            const attackers = lineup.filter(p => players.ATT.includes(p));
            const defenders = lineup.filter(p => players.DEF.includes(p));
            
            const attackScore = attackers.length > 0 
                ? (attackers.reduce((sum, p) => sum + p.rating, 0) / attackers.length).toFixed(0)
                : 0;
            const defenseScore = defenders.length > 0
                ? (defenders.reduce((sum, p) => sum + p.rating, 0) / defenders.length).toFixed(0)
                : 0;
            
            document.getElementById('avgRating').textContent = avgRating;
            document.getElementById('avgAge').textContent = avgAge;
            document.getElementById('totalCaps').textContent = totalCaps;
            document.getElementById('attackScore').textContent = attackScore;
            document.getElementById('defenseScore').textContent = defenseScore;
        }

        async function exportAsImage() {
            const pitchContainer = document.querySelector('.pitch-container');
            
            try {
                const canvas = await html2canvas(pitchContainer, {
                    backgroundColor: '#2d5a3d',
                    scale: 2,
                    logging: false
                });
                
                const link = document.createElement('a');
                link.download = `ghana-blackstars-lineup-${new Date().getTime()}.jpg`;
                link.href = canvas.toDataURL('image/jpeg', 0.95);
                link.click();
            } catch (error) {
                alert('Export failed. Please try again.');
            }
        }

        async function exportAsPDF() {
            const pitchContainer = document.querySelector('.pitch-container');
            
            try {
                const canvas = await html2canvas(pitchContainer, {
                    backgroundColor: '#2d5a3d',
                    scale: 2,
                    logging: false
                });
                
                const imgData = canvas.toDataURL('image/jpeg', 0.95);
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                const imgWidth = 190;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                pdf.addImage(imgData, 'JPEG', 10, 10, imgWidth, imgHeight);
                
                const formation = document.getElementById('formationSelect').value;
                pdf.text(`Ghana Black Stars - ${formation}`, 105, imgHeight + 20, { align: 'center' });
                
                pdf.save(`ghana-blackstars-lineup-${new Date().getTime()}.pdf`);
            } catch (error) {
                alert('Export failed. Please try again.');
            }
        }

        document.getElementById('formationSelect').addEventListener('change', (e) => {
            renderFormation(e.target.value);
        });

        document.getElementById('colorTheme').addEventListener('change', (e) => {
            applyColorTheme(e.target.value);
        });

        function applyColorTheme(theme) {
            const themes = {
                classic: {
                    unselected: 'linear-gradient(135deg, #d4af37 0%, #f4d03f 100%)',
                    selected: 'linear-gradient(135deg, #ce1126 0%, #ff4444 100%)',
                    unselectedText: '#000',
                    selectedText: '#fff',
                    border: '#1a472a',
                    selectedBorder: '#fff'
                },
                red: {
                    unselected: 'linear-gradient(135deg, #fff 0%, #f0f0f0 100%)',
                    selected: 'linear-gradient(135deg, #ce1126 0%, #8b0000 100%)',
                    unselectedText: '#000',
                    selectedText: '#fff',
                    border: '#ce1126',
                    selectedBorder: '#fff'
                },
                green: {
                    unselected: 'linear-gradient(135deg, #d4af37 0%, #b8941e 100%)',
                    selected: 'linear-gradient(135deg, #006b3f 0%, #004d2d 100%)',
                    unselectedText: '#000',
                    selectedText: '#fcd116',
                    border: '#006b3f',
                    selectedBorder: '#fcd116'
                },
                black: {
                    unselected: 'linear-gradient(135deg, #d4af37 0%, #f4d03f 100%)',
                    selected: 'linear-gradient(135deg, #1a1a1a 0%, #000 100%)',
                    unselectedText: '#000',
                    selectedText: '#d4af37',
                    border: '#000',
                    selectedBorder: '#d4af37'
                },
                blue: {
                    unselected: 'linear-gradient(135deg, #fff 0%, #e8e8e8 100%)',
                    selected: 'linear-gradient(135deg, #0066cc 0%, #003d7a 100%)',
                    unselectedText: '#000',
                    selectedText: '#fff',
                    border: '#0066cc',
                    selectedBorder: '#fff'
                }
            };

            const selectedTheme = themes[theme];
            const style = document.createElement('style');
            style.id = 'dynamic-theme';
            
            const existingStyle = document.getElementById('dynamic-theme');
            if (existingStyle) existingStyle.remove();
            
            style.textContent = `
                .player-slot {
                    background: ${selectedTheme.unselected} !important;
                    border-color: ${selectedTheme.border} !important;
                }
                .player-slot .player-name {
                    color: ${selectedTheme.unselectedText} !important;
                }
                .player-slot.selected {
                    background: ${selectedTheme.selected} !important;
                    border-color: ${selectedTheme.selectedBorder} !important;
                }
                .player-slot.selected .player-name {
                    color: ${selectedTheme.selectedText} !important;
                }
            `;
            
            document.head.appendChild(style);
        }

        renderFormation('4-3-3');
    </script>
</body>
</html>